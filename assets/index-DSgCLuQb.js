(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(i){if(i.ep)return;i.ep=!0;const a=o(i);fetch(i.href,a)}})();const u={key:"linksync_user",guestKey:"linksync_is_guest",login(t){localStorage.setItem(this.key,JSON.stringify(t)),localStorage.removeItem(this.guestKey)},setGuest(){localStorage.setItem(this.guestKey,"true")},logout(){localStorage.removeItem(this.key),localStorage.removeItem(this.guestKey)},getUser(){const t=localStorage.getItem(this.key);return t?JSON.parse(t):null},isGuest(){return localStorage.getItem(this.guestKey)==="true"},getSocialData(){const t=localStorage.getItem("linksync_social"),n=t?JSON.parse(t):{};return{friends:n.friends||[],blocked:n.blocked||[],liked:n.liked||[],friendRequests:n.friendRequests||[]}},updateSocialData(t){localStorage.setItem("linksync_social",JSON.stringify(t))}};function re(){const t=document.getElementById("authForm"),n=document.getElementById("guestBtn"),o=document.getElementById("tabLogin"),e=document.getElementById("tabSignup"),i=document.getElementById("signupFields"),a=document.getElementById("submitText");let r=!0;o.addEventListener("click",()=>{r=!0,o.classList.add("active"),e.classList.remove("active"),i.classList.add("hidden"),a.textContent="Login"}),e.addEventListener("click",()=>{r=!1,e.classList.add("active"),o.classList.remove("active"),i.classList.remove("hidden"),a.textContent="Sign Up"}),n.addEventListener("click",async()=>{try{const p=await(await fetch("http://localhost:3000/api/auth/guest",{method:"POST"})).json();u.setGuest(p.id),localStorage.removeItem("linksync_profile_complete"),g("profile-setup")}catch(c){console.error("Guest login failed:",c),u.setGuest(),localStorage.removeItem("linksync_profile_complete"),g("profile-setup")}}),t.addEventListener("submit",async c=>{c.preventDefault();const p=t.querySelector('input[type="email"]').value,f=t.querySelector('input[type="password"]').value,y="/api/auth/register";try{const m=await(await fetch("http://localhost:3000"+y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,password:f,username:p.split("@")[0]})})).json();u.login(m),localStorage.removeItem("linksync_profile_complete"),g("profile-setup")}catch(x){console.error("Auth failed:",x);const m={id:"local_"+Date.now(),email:p,username:p.split("@")[0]};u.login(m),localStorage.removeItem("linksync_profile_complete"),g("profile-setup")}})}const ae=["Gaming Sessions","Anime Drops","Foodie","Flirty Chats","Music Stans","Love Stories","Platonic Bonds","Cozy Gaming","Anime Waifus","Street Foodies","Subtle Flirts","Late Night Ramen","Controller Battles","Manga Panels","Snack Tier Lists","Playlist Swaps"];function ce(){const t=document.getElementById("interestGrid"),n=document.getElementById("connectRandom"),o=document.getElementById("connectGirl"),e=document.getElementById("connectBoy");ae.forEach(m=>{const h=document.createElement("div");h.className="interest-item",h.textContent=m,h.onclick=()=>{h.classList.toggle("selected")},t.appendChild(h)});const i=document.getElementById("toggleAgeBtn"),a=document.getElementById("toggleCountryBtn"),r=document.getElementById("ageFilterWrapper"),c=document.getElementById("countryFilterWrapper"),p=(m,h,v,S,L)=>{h.style.display=v?"block":"none",m.style.borderColor=v?"var(--neon-cyan)":"var(--glass-border)",m.style.color=v?"var(--neon-cyan)":"",m.textContent=v?`‚úï Remove ${S}`:`${L} Filter by ${S}`};let f=!1,y=!1;i&&r&&(i.onclick=()=>{f=!f,p(i,r,f,"Age","üéÇ")}),a&&c&&(a.onclick=()=>{y=!y,p(a,c,y,"Country","üåê")});const x=(m="any")=>{const h=Array.from(document.querySelectorAll(".interest-item.selected")).map(T=>T.textContent),v=r&&r.style.display!=="none",S=c&&c.style.display!=="none",L=v&&document.getElementById("filterMinAge")?.value||"18",N=v&&document.getElementById("filterMaxAge")?.value||"100",O=S&&document.getElementById("filterCountry")?.value||"ANY";sessionStorage.setItem("linksync_pref_gender",m),sessionStorage.setItem("linksync_pref_interests",JSON.stringify(h)),sessionStorage.setItem("linksync_pref_age_active",v?"true":"false"),sessionStorage.setItem("linksync_pref_country_active",S?"true":"false"),sessionStorage.setItem("linksync_pref_min_age",L),sessionStorage.setItem("linksync_pref_max_age",N),sessionStorage.setItem("linksync_pref_country",O),g("video")};n.addEventListener("click",()=>x("any")),o.addEventListener("click",()=>x("female")),e.addEventListener("click",()=>x("male"))}function le(){const t=document.getElementById("localVideo"),n=document.getElementById("remoteVideo"),o=document.getElementById("statusOverlay"),e=o.querySelector(".status-text"),i=document.getElementById("vidNextBtn"),a=document.getElementById("vidStopBtn");let r=null,c=null,p=null,f=null,y=null,x=!1,m=null;function h(){console.log("[VIDEO] Initializing PeerJS & Matchmaker...");const l=`${window.location.protocol==="https:"?"wss:":"ws:"}//linksync-backend.hellohardhik.workers.dev`;c=new WebSocket(l),c.onmessage=d=>{const b=JSON.parse(d.data);b.type==="match-found"&&(console.log("[WS] Match found! Role:",b.role),b.role==="caller"?initiateCall(b.partnerPeerId):e.textContent="Connecting to peer...")},r=new Peer(void 0,{debug:1,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]}}),r.on("open",d=>{console.log("[PEER] My ID:",d),v()}),r.on("call",d=>{console.log("[PEER] Incoming call from:",d.peer),y&&(d.answer(y),N(d))}),r.on("connection",d=>{console.log("[PEER] Incoming chat connection"),O(d)}),c.on("match-found",d=>{console.log("[SOCKET] Match found! Role:",d.role),d.role==="caller"?initiateCall(d.partnerPeerId):e.textContent="Connecting to peer..."}),r.on("error",d=>{console.error("[PEER] PeerJS Error:",d.type,d),d.type==="peer-unavailable"&&S()})}async function v(){try{const s=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});y=s,t.srcObject=s,await t.play(),S()}catch(s){console.error("Camera error:",s),e.textContent="Camera access required!"}}function S(){c&&c.readyState===1&&c.send(JSON.stringify({type:"stop-search"})),T(),x=!1,n.srcObject=null,n.src="",n.style.opacity="0",o.style.display="block",ee();const s=JSON.parse(sessionStorage.getItem("linksync_pref_interests")||"[]"),l=L();e.textContent=s.length>0?`Finding someone into ${s[0]}${l}...`:`Searching for a match${l}...`;const d=document.getElementById("selfViewWrapper");d&&(d.classList.add("searching-mode"),d.style.cssText="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border-radius: 0; border: none; z-index: 5;"),r&&r.id&&c.readyState===1&&c.send(JSON.stringify({type:"start-search",peerId:r.id,interests:s,gender:sessionStorage.getItem("linksync_pref_gender"),age:sessionStorage.getItem("linksync_pref_min_age"),country:sessionStorage.getItem("linksync_pref_country")}))}function L(){const s=sessionStorage.getItem("linksync_pref_age_active")==="true",l=sessionStorage.getItem("linksync_pref_country_active")==="true",d=sessionStorage.getItem("linksync_pref_min_age")||"18",b=sessionStorage.getItem("linksync_pref_max_age")||"100",D=sessionStorage.getItem("linksync_pref_country");let B=[];return s&&B.push(`Age ${d}-${b}`),l&&D!=="ANY"&&B.push(`in ${D}`),B.length>0?` (${B.join(" ")})`:""}function N(s){p=s,s.on("stream",l=>{n.srcObject=l,n.style.opacity="1",n.play().catch(()=>{}),Q({name:"User Matched",id:s.peer})}),s.on("close",S),s.on("error",S)}function O(s){f=s,s.on("data",l=>{l.type==="chat"&&K(l.text,"remote")}),s.on("close",S)}function T(){p&&p.close(),f&&f.close(),p=null,f=null}function Q(s){x=!0,m=s,o.style.display="none",I&&(I.style.color="",I.textContent="üë§+"),A&&A.classList.remove("liked-glow");const l=document.getElementById("selfViewWrapper");l&&(l.classList.remove("searching-mode"),l.style.cssText="position: absolute; top: 20px; right: 20px; width: 210px; height: 130px; border-radius: 12px; overflow: hidden; border: 4px solid #000000; box-shadow: 0 10px 30px rgba(0,0,0,0.6); cursor: grab; z-index: 20; background: #111;"),s.isBot&&Z()}function Z(){let s=document.getElementById("remoteProfileOverlay");s||(s=document.createElement("div"),s.id="remoteProfileOverlay",document.querySelector(".call-wrapper").appendChild(s)),s.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 15; backdrop-filter: blur(10px); background: rgba(0,0,0,0.4);",s.innerHTML=`
            <img src="${m.profilePic}" style="width: 200px; height: 200px; border-radius: 50%; border: 4px solid var(--neon-cyan); margin-bottom: 1rem; box-shadow: 0 0 30px var(--neon-cyan);">
            <h2 style="color: #fff; font-size: 2.2rem; text-shadow: 0 0 10px rgba(0,0,0,0.5);">${m.name}</h2>
            <p style="color: var(--text-dim);">Establishing secure connection...</p>
        `,s.style.display="flex"}function ee(){const s=document.getElementById("remoteProfileOverlay");s&&(s.style.display="none")}i.onclick=()=>S(),a.onclick=()=>{y&&y.getTracks().forEach(s=>s.stop()),T(),r&&r.destroy(),g("home")};const I=document.getElementById("addFriendBtn"),A=document.getElementById("likeBtn");document.getElementById("reportBtn"),A.onclick=()=>{if(m&&(A.classList.toggle("liked-glow"),A.classList.contains("liked-glow"))){const s=u.getSocialData();s.liked.some(l=>l.name===m.name)||(s.liked.push(m),u.updateSocialData(s))}},I.onclick=()=>{if(!m)return;I.style.color="var(--neon-cyan)",I.textContent="‚úîÔ∏è";const s=u.getSocialData();s.friendRequests.some(l=>l.name===m.name)||(s.friendRequests.push(m),u.updateSocialData(s))};const $=document.getElementById("chatInput"),te=document.getElementById("sendBtn"),C=document.getElementById("chatMessages"),ne=document.getElementById("toggleChatBtn"),oe=document.getElementById("closeChatBtn"),H=document.getElementById("chatOverlay");ne.onclick=()=>H.classList.toggle("minimized"),oe.onclick=()=>H.classList.add("minimized");function G(){const s=$.value.trim();s&&(K(s,"local"),$.value="",f&&f.open?f.send({type:"chat",text:s}):m?.isBot&&se())}function se(){const s="typ_"+Date.now(),l=document.createElement("div");l.className="chat-msg remote typing-indicator",l.id=s,l.innerHTML='<span class="dot"></span><span class="dot"></span><span class="dot"></span>',C.appendChild(l),C.scrollTop=C.scrollHeight,setTimeout(()=>{const d=document.getElementById(s);if(d&&d.remove(),!x)return;const b=["Hey!","How are you?","This site looks amazing!","I'm a bot, but I can chat!"];K(b[Math.floor(Math.random()*b.length)],"remote")},2e3)}function K(s,l){const d=document.createElement("div");d.className=`chat-msg ${l}`,d.textContent=s,C.appendChild(d),C.scrollTop=C.scrollHeight}te.onclick=G,$.onkeypress=s=>{s.key==="Enter"&&G()},h();const E=document.getElementById("selfViewWrapper"),ie=document.querySelector(".call-wrapper");let V=!1,W=0,z=0;E.onmousedown=s=>{if(E.classList.contains("searching-mode"))return;V=!0;const l=E.getBoundingClientRect();W=s.clientX-l.left,z=s.clientY-l.top},document.onmousemove=s=>{if(!V)return;const l=ie.getBoundingClientRect();let d=s.clientX-l.left-W,b=s.clientY-l.top-z;const D=l.width-E.offsetWidth,B=l.height-E.offsetHeight;d=Math.max(0,Math.min(d,D)),b=Math.max(0,Math.min(b,B)),E.style.left=d+"px",E.style.top=b+"px",E.style.right="auto",E.style.bottom="auto"},document.onmouseup=()=>V=!1}function R(){const t=u.getUser();if(!t)return;const n=document.getElementById("profileName"),o=document.getElementById("profileEmail"),e=document.getElementById("friendRequestsList"),i=document.getElementById("friendsList"),a=document.getElementById("likedList"),r=document.getElementById("blockedList");n.textContent=t.username||"Guest",o.textContent=t.email||"guest@linksync.app";let c=u.getSocialData();(!c.friendRequests||c.friendRequests.length===0)&&(c.friendRequests=[{id:"req1",name:"Alex Johnson",profilePic:"https://i.pravatar.cc/100?img=12"},{id:"req2",name:"Sam Rivera",profilePic:"https://i.pravatar.cc/100?img=25"}]),(!c.friends||c.friends.length===0)&&(c.friends=[{id:"f1",name:"Jordan Lee",profilePic:"https://i.pravatar.cc/100?img=33"}]),(!c.liked||c.liked.length===0)&&(c.liked=[{id:"l1",name:"Casey Morgan",profilePic:"https://i.pravatar.cc/100?img=45"}]),(!c.blocked||c.blocked.length===0)&&(c.blocked=[]),u.updateSocialData(c),de(e,c.friendRequests),ue(i,c.friends),me(a,c.liked),pe(r,c.blocked)}function de(t,n){if(t.innerHTML="",!n||n.length===0){t.innerHTML='<div style="color: var(--text-dim); font-style: italic;">No pending requests</div>';return}n.forEach(o=>{const e=document.createElement("div");e.className="glass-panel",e.style.cssText="padding: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px;",e.innerHTML=`
      <img src="${o.profilePic}" style="width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--neon-purple);">
      <span style="flex: 1; font-weight: 500;">${o.name}</span>
      <button class="btn btn-primary btn-sm" onclick="window.acceptFriendRequest('${o.id}')">Accept</button>
      <button class="btn btn-outline btn-sm" onclick="window.rejectFriendRequest('${o.id}')">Reject</button>
    `,t.appendChild(e)})}function ue(t,n){if(t.innerHTML="",!n||n.length===0){t.innerHTML='<div style="color: var(--text-dim); font-style: italic;">No friends yet</div>';return}n.forEach(o=>{const e=document.createElement("div");e.className="glass-panel",e.style.cssText="padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px;",e.innerHTML=`
      <img src="${o.profilePic}" style="width: 40px; height: 40px; border-radius: 50%;">
      <span style="flex: 1;">${o.name}</span>
      <button class="btn btn-ghost btn-sm">üí¨</button>
    `,t.appendChild(e)})}function me(t,n){if(t.innerHTML="",!n||n.length===0){t.innerHTML='<div style="color: var(--text-dim); font-style: italic;">No liked users</div>';return}n.forEach(o=>{const e=document.createElement("div");e.className="glass-panel",e.style.cssText="padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px;",e.innerHTML=`
      <img src="${o.profilePic}" style="width: 40px; height: 40px; border-radius: 50%;">
      <span style="flex: 1;">${o.name}</span>
      <span style="color: var(--neon-pink);">‚ù§Ô∏è</span>
    `,t.appendChild(e)})}function pe(t,n){if(t.innerHTML="",!n||n.length===0){t.innerHTML='<div style="color: var(--text-dim); font-style: italic;">No blocked users</div>';return}n.forEach(o=>{const e=document.createElement("div");e.className="glass-panel",e.style.cssText="padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px;",e.innerHTML=`
      <img src="${o.profilePic}" style="width: 40px; height: 40px; border-radius: 50%; filter: grayscale(100%);">
      <span style="flex: 1; color: var(--text-dim);">${o.name}</span>
      <button class="btn btn-outline btn-sm" onclick="window.unblockUser('${o.id}')">Unblock</button>
    `,t.appendChild(e)})}window.acceptFriendRequest=t=>{const n=u.getSocialData(),o=n.friendRequests.findIndex(e=>e.id===t);if(o!==-1){const[e]=n.friendRequests.splice(o,1);n.friends.push(e),u.updateSocialData(n),R()}};window.rejectFriendRequest=t=>{const n=u.getSocialData();n.friendRequests=n.friendRequests.filter(o=>o.id!==t),u.updateSocialData(n),R()};window.unblockUser=t=>{const n=u.getSocialData();n.blocked=n.blocked.filter(o=>o.id!==t),u.updateSocialData(n),R()};function fe(){document.addEventListener("contextmenu",e=>(e.preventDefault(),k("Screenshots are not allowed on LinkSync"),!1)),document.addEventListener("keydown",e=>{if([e.key==="PrintScreen",e.key==="Print",e.metaKey&&e.shiftKey&&e.key==="S",e.metaKey&&e.shiftKey&&e.key==="s",e.key==="Meta"&&e.shiftKey,e.metaKey&&e.shiftKey&&["3","4","5","6"].includes(e.key),(e.ctrlKey||e.metaKey)&&e.key==="s",(e.ctrlKey||e.metaKey)&&e.key==="S",e.key==="F12",e.ctrlKey&&e.shiftKey&&e.key==="I",e.ctrlKey&&e.shiftKey&&e.key==="i",e.ctrlKey&&e.shiftKey&&e.key==="J",e.ctrlKey&&e.shiftKey&&e.key==="j",e.ctrlKey&&e.shiftKey&&e.key==="C",e.ctrlKey&&e.shiftKey&&e.key==="c",e.metaKey&&e.key==="g",e.metaKey&&e.key==="G",e.metaKey&&e.altKey&&e.key==="r",e.metaKey&&e.altKey&&e.key==="R"].some(a=>a))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),k("‚ö†Ô∏è Screenshot Blocked - Privacy Protected"),w(),!1});let t=!1,n=!1;if(document.addEventListener("keydown",e=>{if((e.key==="Meta"||e.key==="OS")&&(t=!0),e.key==="Shift"&&(n=!0),t&&n)return e.preventDefault(),k("‚ö†Ô∏è Snipping Tool Blocked"),w(),!1}),document.addEventListener("keyup",e=>{(e.key==="Meta"||e.key==="OS")&&(t=!1),e.key==="Shift"&&(n=!1)}),ge()){let e=Date.now();document.addEventListener("visibilitychange",()=>{const i=Date.now();i-e<300&&document.hidden&&(k("üì± Mobile Screenshot Detected"),w()),e=i}),window.addEventListener("blur",()=>{setTimeout(()=>{document.hidden&&(k("üì± Screenshot Attempt Detected"),w())},50)})}let o;document.addEventListener("visibilitychange",()=>{document.hidden?o=setTimeout(()=>{document.body.classList.add("privacy-blur-aggressive"),k("üîí Content Hidden - Privacy Protection Active")},50):(clearTimeout(o),document.body.classList.remove("privacy-blur-aggressive"))}),window.addEventListener("blur",()=>{document.body.classList.add("privacy-blur"),ye()}),window.addEventListener("focus",()=>{document.body.classList.remove("privacy-blur"),he()}),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(navigator.mediaDevices.getDisplayMedia,navigator.mediaDevices.getDisplayMedia=function(){return k("üö´ Screen Recording Blocked"),w(),Promise.reject(new Error("Screen recording blocked by LinkSync"))}),ke(),ve(),be(),document.addEventListener("dragstart",e=>(e.preventDefault(),!1)),document.addEventListener("selectstart",e=>{if(e.target.closest(".video-container, .chat-overlay, .auth-card"))return e.preventDefault(),!1}),xe(),document.addEventListener("copy",e=>{if(e.target.closest(".video-container, .chat-overlay"))return e.preventDefault(),k("‚ö†Ô∏è Copy Disabled for Privacy"),!1}),Se(),document.addEventListener("keydown",e=>{e.key==="PrintScreen"&&(e.preventDefault(),document.body.style.filter="blur(20px)",setTimeout(()=>{document.body.style.filter=""},2e3),k("‚ö†Ô∏è Screenshots disabled for privacy!"))}),Ee()}function ge(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function w(){document.body.classList.add("privacy-blur-aggressive"),setTimeout(()=>{document.body.classList.remove("privacy-blur-aggressive")},2e3)}function ye(){document.querySelectorAll("video").forEach(o=>{o.id==="localVideo"||o.dataset.isLocal==="true"||(o.dataset.wasPlaying=!o.paused,o.pause(),o.style.opacity="0")});const n=document.getElementById("chatOverlay");n&&(n.style.opacity="0")}function he(){document.querySelectorAll("video").forEach(o=>{if(o.id==="localVideo"||o.dataset.isLocal==="true"){o.style.opacity="1";return}o.dataset.wasPlaying==="true"&&o.play(),o.style.opacity="1"});const n=document.getElementById("chatOverlay");n&&(n.style.opacity="1")}function k(t){const n=document.getElementById("privacy-warning");n&&n.remove();const o=document.createElement("div");o.id="privacy-warning",o.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 0, 0, 0.95);
    color: white;
    padding: 2rem 3rem;
    border-radius: 16px;
    font-size: 1.2rem;
    font-weight: bold;
    z-index: 10000;
    box-shadow: 0 10px 40px rgba(255, 0, 0, 0.5);
    animation: shake 0.5s;
    text-align: center;
  `,o.innerHTML=`
    <div>
      <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
      <div>${t}</div>
      <div style="font-size: 0.9rem; margin-top: 1rem; opacity: 0.9;">
        This action has been logged for security purposes
      </div>
    </div>
  `,document.body.appendChild(o),setTimeout(()=>{o.style.opacity="0",o.style.transition="opacity 0.5s",setTimeout(()=>o.remove(),500)},3e3),console.warn(`[SECURITY] Screenshot attempt at ${new Date().toISOString()}`)}function ve(){const t=document.createElement("div");t.id="dynamic-watermark",t.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9998;
    opacity: 0.02;
    background-image: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 100px,
      rgba(255, 255, 255, 0.1) 100px,
      rgba(255, 255, 255, 0.1) 200px
    );
  `,document.body.appendChild(t);const n=document.createElement("div");n.style.cssText=`
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-size: 10px;
    color: rgba(255, 255, 255, 0.15);
    pointer-events: none;
    z-index: 9998;
    user-select: none;
  `;function o(){const i=JSON.parse(localStorage.getItem("linksync_user")||"{}").username||"Guest";n.textContent=`${i} - ${new Date().toLocaleString()}`}o(),setInterval(o,1e3),document.body.appendChild(n)}function be(){for(let t=0;t<5;t++){const n=document.createElement("div");n.style.cssText=`
      position: fixed;
      top: ${Math.random()*80+10}%;
      left: ${Math.random()*80+10}%;
      font-size: 8px;
      color: rgba(255, 255, 255, 0.01);
      pointer-events: none;
      z-index: 9998;
      user-select: none;
      transform: rotate(${Math.random()*360}deg);
    `,n.textContent=`LinkSync-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,document.body.appendChild(n)}}function ke(){const n=document.createElement("canvas").getContext("webgl");if(n){const o=n.getExtension("WEBGL_debug_renderer_info");if(o){const e=n.getParameter(o.UNMASKED_RENDERER_WEBGL);(e.includes("SwiftShader")||e.includes("llvmpipe"))&&(console.warn("[SECURITY] Potential screen capture software detected"),k("‚ö†Ô∏è Screen Capture Software Detected"))}}}function xe(){let t=0,n=0;document.addEventListener("keydown",()=>{const o=Date.now();o-n<50&&(t++,t>5&&(k("‚ö†Ô∏è Suspicious Activity Detected"),w())),n=o}),setInterval(()=>{t=Math.max(0,t-1)},5e3)}function Se(){HTMLCanvasElement.prototype.toDataURL=function(){return k("‚ö†Ô∏è Canvas Capture Blocked"),console.warn("[SECURITY] Canvas capture attempt blocked"),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=="}}function Ee(){const t=()=>{document.querySelectorAll("video").forEach(e=>{e.dataset.monitored||(e.dataset.monitored="true",e.addEventListener("loadedmetadata",()=>{navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(console.warn("[SECURITY] Screen capture API detected - monitoring video stream"),e.srcObject&&e.srcObject.getVideoTracks().forEach(a=>{const r=a.getSettings();(r.displaySurface||r.logicalSurface)&&(k("üö´ Screen Recording Detected - Stream Paused"),e.pause(),w(),console.warn("[SECURITY] Screen capture stream detected and paused"))}))}),e.addEventListener("play",()=>{Array.from(document.querySelectorAll("video")).filter(a=>!a.paused).length>3&&console.warn("[SECURITY] Suspicious number of video streams detected")}))})};t(),new MutationObserver(()=>{t()}).observe(document.body,{childList:!0,subtree:!0})}const Y=document.createElement("style");Y.textContent=`
  .privacy-blur {
    filter: blur(20px) !important;
    transition: filter 0.2s;
  }

  .privacy-blur-aggressive {
    filter: blur(50px) brightness(0.3) !important;
    transition: filter 0.1s;
  }

  @keyframes shake {
    0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
    25% { transform: translate(-50%, -50%) rotate(-5deg); }
    75% { transform: translate(-50%, -50%) rotate(5deg); }
  }

  body {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }

  input, textarea {
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
    user-select: text;
  }

  /* Prevent screenshot on mobile */
  @media (max-width: 768px) {
    * {
      -webkit-user-select: none !important;
      -webkit-touch-callout: none !important;
    }
  }
`;document.head.appendChild(Y);function we(){const t=document.getElementById("particleBackground");if(!t)return;const n=100;for(let o=0;o<n;o++){const e=document.createElement("div");e.className="particle-container";const i=document.createElement("div");i.className="particle";const a=Math.floor(Math.random()*8)+4;e.style.width=`${a}px`,e.style.height=`${a}px`;const r=Math.random()*100,c=100+Math.random()*10,p=Math.random()*100,f=-c-Math.random()*30,y=7e3+Math.random()*4e3,x=Math.random()*11e3,m=`move-particle-${o}`,h=`
      @keyframes ${m} {
        from {
          transform: translate3d(${r}vw, ${c}vh, 0);
        }
        to {
          transform: translate3d(${p}vw, ${f}vh, 0);
        }
      }
    `,v=document.createElement("style");v.textContent=h,document.head.appendChild(v),e.style.animationName=m,e.style.animationDuration=`${y}ms`,e.style.animationDelay=`${x}ms`,i.style.animationDelay=`${Math.random()*4e3}ms`,e.appendChild(i),t.appendChild(e)}}function Ie(t){if(t.parentElement?.querySelector("#video-watermark"))return;const o=document.createElement("div");o.id="video-watermark";const i=JSON.parse(localStorage.getItem("linksync_user")||"{}").username||"Guest";new Date().toISOString();const a=Math.random().toString(36).substr(2,9);if(o.style.cssText=`
    position: absolute;
    top: 10%;
    left: 10%;
    color: rgba(255, 255, 255, 0.4);
    font-size: 14px;
    pointer-events: none;
    z-index: 100;
    font-family: 'DM Sans', Arial, sans-serif;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    animation: moveWatermark 15s infinite;
    user-select: none;
    mix-blend-mode: difference;
  `,o.textContent=`${i} | ${a}`,t.parentElement&&(t.parentElement.style.position="relative",t.parentElement.appendChild(o)),setInterval(()=>{const r=Math.random()*80+10,c=Math.random()*80+10;o.style.top=`${r}%`,o.style.left=`${c}%`},15e3),!document.getElementById("watermark-animation")){const r=document.createElement("style");r.id="watermark-animation",r.textContent=`
      @keyframes moveWatermark {
        0% { transform: translate(0, 0) rotate(0deg); opacity: 0.4; }
        25% { transform: translate(20px, 30px) rotate(5deg); opacity: 0.6; }
        50% { transform: translate(-10px, 20px) rotate(-3deg); opacity: 0.5; }
        75% { transform: translate(15px, -15px) rotate(4deg); opacity: 0.7; }
        100% { transform: translate(0, 0) rotate(0deg); opacity: 0.4; }
      }
    `,document.head.appendChild(r)}console.log("[DRM] Dynamic watermark applied")}let q=null;function X(){document.querySelectorAll("video").forEach(n=>{n.dataset.drmInitialized||(n.dataset.drmInitialized="true",Ie(n),n.addEventListener("loadedmetadata",()=>{console.log("[DRM] Video loaded, watermark active")},{once:!0}))}),q||(q=new MutationObserver(n=>{n.some(e=>Array.from(e.addedNodes).some(i=>i.nodeName==="VIDEO"||i.querySelectorAll&&i.querySelectorAll("video").length>0))&&X()}),q.observe(document.body,{childList:!0,subtree:!0}))}function Ce(){document.addEventListener("contextmenu",n=>{if(n.target.tagName==="VIDEO")return n.preventDefault(),console.warn("[DRM] Video download attempt blocked"),!1});const t=HTMLVideoElement.prototype.getAttribute;HTMLVideoElement.prototype.getAttribute=function(n){return n==="src"&&this.dataset.protected==="true"?(console.warn("[DRM] Video source access blocked"),null):t.call(this,n)}}let P=null,F=0;const Be=50;function U(){if(typeof window.VANTA>"u"||typeof window.THREE>"u"){F++,F<Be?setTimeout(U,100):console.warn("[VANTA] Libraries failed to load after 5s, skipping.");return}Le()}function Le(){const t=document.getElementById("vantaBackground");if(t)try{P&&P.destroy(),P=window.VANTA.WAVES({el:t,mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color:2454188,shininess:30,waveHeight:15,waveSpeed:1,zoom:1,THREE:window.THREE}),window.vantaEffect=P}catch(n){console.error("[VANTA] Error:",n)}}function Ae(){const t=document.getElementById("profileSetupForm");t&&t.addEventListener("submit",n=>{n.preventDefault();const o=document.getElementById("setupUsername").value.trim(),e=document.getElementById("setupGender").value,i=parseInt(document.getElementById("setupAge").value),a=document.getElementById("setupCountry").value;if(!o||o.length<3){alert("Username must be at least 3 characters");return}if(!e){alert("Please select your gender");return}if(!i||i<18||i>100){alert("Please enter a valid age (18-100)");return}if(!a){alert("Please select your country");return}let r=u.getUser();u.isGuest()?(r={username:o,email:"guest@linksync.app",gender:e,age:i,country:a,isGuest:!0},localStorage.setItem("linksync_user",JSON.stringify(r))):r&&(r.username=o,r.gender=e,r.age=i,r.country=a,localStorage.setItem("linksync_user",JSON.stringify(r))),localStorage.setItem("linksync_profile_complete","true"),console.log("[PROFILE] Profile setup completed:",{username:o,gender:e,age:i,country:a}),g("home")})}function Me(){const t=u.getUser(),n=u.isGuest(),o=localStorage.getItem("linksync_profile_complete");return!!((t||n)&&!o||t&&(!t.username||!t.gender||!t.age||!t.country))}const J=document.querySelector("#app"),_=document.querySelector("#authBtn"),M=document.getElementById("navProfile");function g(t){const n={auth:"view-auth",home:"view-home",video:"view-video",profile:"view-profile","profile-setup":"view-profile-setup"},o=u.getUser(),e=u.isGuest();t!=="auth"&&!o&&!e&&(console.warn("Unauthorized access. Redirecting to auth."),t="auth");const i=n[t];if(!i){console.error("Unknown view:",t);return}const a=document.getElementById(i);if(!a){console.error("Template not found:",i);return}J.innerHTML="";const r=a.content.cloneNode(!0);J.appendChild(r),Te(t),U(),t==="auth"?re():t==="home"?ce():t==="video"?le():t==="profile"?R():t==="profile-setup"&&Ae()}function Te(t){u.getUser()?(_.textContent="Logout",_.onclick=()=>{u.logout(),g("auth")},M&&(M.style.display="inline-block",M.onclick=e=>{e.preventDefault(),g("profile")})):(_.textContent="Login",_.onclick=()=>g("auth"),M&&(M.style.display="none"));const o=document.querySelector(".navbar");t==="video"?o.style.display="none":o.style.display="flex"}function j(){fe(),U(),we(),X(),Ce();const t=u.getUser(),n=u.isGuest();t||n?Me()?g("profile-setup"):g("home"):g("auth")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();window.navigateTo=g;
